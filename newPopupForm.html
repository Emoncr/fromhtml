<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="style.css" /> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Damion&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <!-- <link rel="stylesheet" href="./style.css" /> -->
    <title>Stripe Elements</title>
    <style>
      .mt-10 {
        margin-top: 10px;
      }
      .mb-8 {
        margin-bottom: 8px;
      }
      .mb-30 {
        margin-bottom: 30px;
      }
      .mt-20 {
        margin-top: 20px;
      }
      .w-full {
        width: 100%;
      }
      .flex {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .relative {
        position: relative;
      }
      .label {
        font-size: 14px;
        font-weight: 500;
        color: #474747;
        display: block;
        font-family: "Inter", sans-serif;
      }
      .input {
        height: 42px;
        border: 1px solid #d5d5d5;
        border-radius: 8px;
        padding-left: 12px;
        padding-right: 12px;
        font-size: 14px;
        font-weight: 500;
        color: #474747;
        display: relative;
        font-family: "Inter", sans-serif;
        background-color: transparent;
      }
      input::placeholder {
        color: #969696;
        font-size: 13px;
        font-weight: 500;
        font-family: "Inter", sans-serif;
      }

      .input_container {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .brand_button {
        background-color: #056bbf;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: 0.2s ease-in-out;
        width: 100%;
        box-sizing: border-box;
        font-family: "Inter", sans-serif;
      }

      .brand_button:disabled {
        cursor: auto;
        background-color: #056bbf86;
      }
      .brand_button:disabled:hover {
        background-color: #056bbf86;
      }
      .brand_button:hover {
        opacity: 0.9;
      }
      .brand_button.outline_button {
        background-color: transparent;
        color: #056bbf;
        border: 2px solid #056bbf;
        font-weight: bold;
        margin-top: 35px;
      }
      .brand_button.outline_button:hover {
        background-color: #056bbf;
        color: #ffffff;
        opacity: 0.9;
        outline-color: hsla(207, 95%, 38%, 0.404);
      }

      .form_container {
        box-shadow: 0px 2px 4px 0px #00000014;
        background-color: #fff;
        width: calc(100% - 40px);
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        padding: 60px 20px 20px 20px;
        border-radius: 10px;
        font-family: "Inter", sans-serif;
        position: relative;
      }

      /*=================== Step Indicator Colors ========================== */
      .step-container {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        gap: 8px;
        max-width: 300px;
        margin: 0 auto;
      }

      .step-button {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: background-color 0.2s, color 0.2s;
        border: 2px solid transparent;
      }

      .step-button-active {
        background-color: #056bbf;
        color: #ffffff;
        border-color: #056bbf;
      }

      .step-button-inactive {
        background-color: transparent;
        color: #6b7280;
        border-color: rgba(91, 112, 131, 0.2);
      }

      .step-connector {
        height: 4px;
        width: 100%;
        margin: 0 4px;
        border-radius: 10px;
      }

      .step-connector-active {
        background-color: #056bbf;
      }

      .step-connector-inactive {
        background-color: rgba(
          91,
          112,
          131,
          0.2
        ); /* Lighter version of primary color */
      }

      /* =======Starting STEP 1 FORM CSS ======= */
      .step_title > h4 {
        text-align: center;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 35px;
        margin-top: 30px;
        color: #474747;
      }

      /* TOGGLE BUTTON CSS */
      .toggle_container {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .toggle_button {
        display: inline-flex;
        width: 100%;
        position: relative;
        padding: 0.5rem;
        background-color: #f8f8f8;
        border-radius: 14px;
        box-shadow: inset 0px 2px 4px 0px #00000014;
        height: 40px;
      }

      .toggle_background {
        position: absolute;
        top: 6px;
        bottom: 6px;
        left: 6px;
        width: calc(50% - 6px);
        background-color: #056bbf;
        border-radius: 11px;
        transition: all 0.3s ease;
      }

      .toggle_button input {
        display: none;
      }

      .toggle_button label {
        flex: 1;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #969696;
        padding: 12px 0;
        /* transition: color 0.3s ease-in-out; */
      }

      .toggle_button input#toggle1:checked ~ .toggle_background {
        transform: translateX(0);
      }

      .toggle_button input#toggle2:checked ~ .toggle_background {
        transform: translateX(100%);
      }

      .toggle_button input#toggle1:checked + label[for="toggle1"],
      .toggle_button input#toggle2:checked + label[for="toggle2"] {
        color: #ffffff;
        z-index: 9999;
      }

      .toggle_button img {
        margin-left: 6px;
        height: 20px;
        width: 20px;
      }

      /* Amounts Button  */

      .amount_buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 20px;
        width: 100%;
      }
      .amount_buttons button {
        font-family: "Inter", sans-serif;
      }

      .amount_button {
        min-width: 100px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #d5d5d5;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        color: #6b7280;
        background-color: transparent;
        transition: all 0.3s ease;
        width: 31%;
      }

      .amount_button.selected {
        background-color: #e0f2fe;
        border-color: #056bbf;
        color: #056bbf;
      }

      .amount_button:hover {
        border-color: #a5b4fc;
      }

      .custom_amount_input {
        margin-top: 20px;
        position: relative;
      }

      /* CUSTOM AMOUNT INPUT FIELD */
      .custom_amount_input {
        margin-top: 40px;
      }
      .custom_amount_input .input {
        padding-left: 35px;
        z-index: 0;
      }

      /* Switch Button CSS */
      .toggle-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: space-between;
        margin-top: 10px;
      }

      .toggle-container {
        position: relative;
        display: inline-block;
        width: 40px;
        height: 20px;
      }

      .toggle-input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #efefef;
        box-shadow: 0px 6px 8px 3px #0000001a inset;
        transition: 0.4s;
        border-radius: 10px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background: linear-gradient(180deg, #ffffff 0%, #e8eaea 100%);
        transition: 0.4s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .toggle-input:checked + .toggle-slider {
        background-color: #056bbf;
      }

      .toggle-input:checked + .toggle-slider:before {
        transform: translateX(20px);
      }

      /* === CURRENCY ====*/
      .currency-symbol,
      .currency-label {
        color: #969696;
        font-weight: medium;
        font-family: Inter, sans-serif;
        font-size: 16px;
        overflow-x: hidden;
        z-index: 9999999999999999;
      }

      .currency-label {
        right: 10px;
        background-color: transparent;
        padding: 0 5px;
        z-index: 50;
      }
      .currency_container {
        padding-left: 12px;
        padding-right: 10px;
        /* background: #dd0808; */
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: -117px;
        z-index: 99999999999;
      }
      .amount_buttons {
        margin-bottom: 60px;
      }

      /* =======Ending STEP 1 FORM CSS ======= */

      /* ========== Starting STEP 2 FORM CSS ======= */

      .name_container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }
      .name_input {
        width: 48%;
      }
      .form-step-2 {
        margin-top: 40px;
      }
      /* ========== Ending STEP 2 FORM CSS ======= */

      /* ======== Starting STEP 3 FORM CSS ======= */
      .form-step-3 {
        margin-top: 40px;
      }
      .stripe-element {
        border: 1px solid #d5d5d5;
        border-radius: 8px;
        padding: 12px 12px;
        font-size: 14px;
        font-weight: 600;
        font-family: "Inter", sans-serif;
      }

      .stripe-element--focus {
        outline-color: #056bbf;
      }

      .card-cvc-expiry-container {
        display: flex;
        gap: 20px;

        justify-content: space-between;
      }
      .card_item_container {
        width: 48%;
      }

      .just-validate-error-label {
        font-size: 12px;
        display: block;
        font-family: inherit;
        font-weight: 500;
        margin-top: -2px;
      }
      .card_container .just-validate-error-label {
        margin-top: 6px;
      }
      .error {
        font-size: 12px;
        display: block;
        font-family: inherit;
        font-weight: 500;
        color: #b81111;
        margin-top: 5px;
        display: none;
      }

      /* ========= Ending STEP 3 FORM CSS ======= */

      /* Message CSS */
      .payment-message {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        margin-bottom: 26px;
      }

      .payment-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .payment-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      /* Loading CSS */
      .loading_container {
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .loading_text {
        margin-left: 10px;
        font-size: 16px;
        font-weight: 700;
        color: #474747;
        font-family: "Inter", sans-serif;
      }

      .main_container {
        display: none;
      }

      /* Password Feild Css */

      .eye-button {
        margin-bottom: -66px;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        margin-right: 7px;
        cursor: pointer;
        z-index: 9999999;
        margin-top: 65px;
      }

      .eye-button button {
        background-color: transparent;
        border: none;
        z-index: 999999999;
        cursor: pointer;
        color: rgb(56, 56, 56);
      }

      /* Dropdown Css */
      .custom-select-wrapper {
        position: relative;
      }

      .custom-select {
        position: relative;
        width: 100%;
      }

      .select-trigger {
        position: relative;
        padding: 14px 14px;
        background: #ffffff;
        border: 1px solid #e1e1e1;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        color: #333;
        font-size: 14px;
      }

      .select-trigger:hover:not(.disabled) {
        border-color: #007bff;
      }

      .select-trigger.disabled {
        background: #f5f5f5;
        cursor: not-allowed;
        color: #999;
      }

      .select-trigger::after {
        content: "";
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%) rotate(45deg);
        width: 8px;
        height: 8px;
        border-right: 2px solid #666;
        border-bottom: 2px solid #666;
        transition: transform 0.3s ease;
      }

      .custom-select.open .select-trigger::after {
        transform: translateY(-50%) rotate(-135deg);
      }

      .options-list {
        position: absolute;
        top: calc(100% + 3px);
        left: 0;
        right: 0;
        background: #ffffff;
        border-radius: 5px;
        box-shadow: 2px 2px 28px -10px rgba(196, 196, 196, 1);
        max-height: 200px;
        overflow-y: auto;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 100;
      }

      .custom-select.open .options-list {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .option-item {
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .option-item:hover {
        background: #f0f7ff;
        color: #007bff;
      }

      .options-list::-webkit-scrollbar {
        width: 8px;
      }

      .options-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .options-list::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
      }

      .options-list::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
      }

      .custom-select-wrapper .just-validate-error-label {
        margin-top: 3px;
      }

      /* ==============================POPUP CSS CODE ======================================== */

      /* Background overlay for the popup */
      #donation-form-popup-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(209, 213, 219, 0);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      /* Popup container styling */
      #donation-form-popup {
        width: 100%;
        height: auto;
        max-height: 80%;
        position: relative;
        overflow-y: auto;
        animation: slideFromMiddle 0.3s ease;
        z-index: 1001;
        border-radius: 10px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .form_container::-webkit-scrollbar {
        width: 8px;
      }

      .form_container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .form_container::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
      }

      @keyframes slideFromMiddle {
        from {
          opacity: 0;
          transform: scale(0.8); /* Start slightly zoomed out */
        }
        to {
          opacity: 1;
          transform: scale(1); /* End at normal size */
        }
      }

      /* Close button styling */
      .close-button {
        position: absolute;
        top: 10px;
        right: 15px;
        width: 36px;
        height: 36px;
        border: none;
        background-color: #dee2e6;
        border-radius: 50%; /* Circular shape */
        font-size: 1.2rem; /* Moderate size */
        font-weight: bold; /* Strong appearance */
        color: #525252; /* Neutral color for "×" */
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s ease, border-color 0.2s ease; /* Smooth transitions */
      }

      .close-button:hover {
        background: #e0e0e0; /* Slightly darker background on hover */
        color: #333; /* Slightly darker "×" */
      }

      .close-button:active {
        background: #d6d6d6; /* Slightly pressed effect */
        color: #000; /* Darkest "×" on press */
      }

      /* ================= Media Queries ========================= */

      /* Extra Large Devices (≥ 1280px) */
      @media screen and (min-width: 1280px) {
      }

      /* Large Devices (≥ 1024px) */
      @media screen and (max-width: 1280px) and (min-width: 1024px) {
      }

      /* Medium Devices (≥ 768px) */
      @media screen and (max-width: 1024px) and (min-width: 768px) {
        .step-container {
          max-width: 350px;
        }
        .step-button {
          width: 40px;
          height: 40px;
        }
      }

      /* Small Devices (≥ 425px) */
      @media screen and (max-width: 768px) and (min-width: 425px) {
        .mt-m-20 {
          margin-top: 20px;
        }

        .step-container {
          max-width: 250px;
        }
        .step-button {
          width: 32px;
          height: 32px;
        }
        .name_container {
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-direction: column;
          width: 100%;
        }
        .name_input {
          width: 100%;
        }

        .card-cvc-expiry-container {
          display: flex;
          flex-direction: column;
        }
        .card_item_container {
          width: 100%;
        }
      }

      /* Extra Small Devices (≥ 320px) */
      @media screen and (max-width: 425px) and (min-width: 320px) {
        .mt-m-20 {
          margin-top: 20px;
        }
        .form_container {
          width: calc(100% - 40px);
        }
        .step-container {
          max-width: 170px;
        }
        .step-button {
          width: 24px;
          height: 24px;
          font-size: 12px;
        }
        .amount_button {
          flex: 1 1 40%;
        }
        .name_container {
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-direction: column;
          width: 100%;
        }
        .name_input {
          width: 100%;
        }

        .card-cvc-expiry-container {
          display: flex;
          flex-direction: column;
        }
        .card_item_container {
          width: 100%;
        }
      }

      /* Extra Small Devices (≥ 320px) */
      @media screen and (max-width: 320px) and (min-width: 220px) {
        .mt-m-20 {
          margin-top: 20px;
        }
        .amount_button {
          flex: 1 1 90%;
        }
        .name_container {
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-direction: column;
          width: 100%;
        }
        .name_input {
          width: 100%;
        }

        .card-cvc-expiry-container {
          display: flex;
          flex-direction: column;
        }
        .card_item_container {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- Popup trigger button -->
    <button>
      <a href="/popup_fovzbbeg"></a>
    </button>
    <a href="/popup_fovzbbeg">Open Payment Form Popup</a>
    <a href="/popup_fovzbbeg">Open Payment Form Popup</a>
    <a href="/popup_fovzbbeg">Open Payment Form Popup</a>

    <div id="donation-form-popup-overlay">
      <div id="donation-form-popup" class="form_container">
        <div id="close-button-container">
          <button class="close-button" aria-label="Close popup">&times;</button>
        </div>
        <div class="loading_container">
          <p class="loading_text">Loading...</p>
        </div>
        <div class="main_container loading">
          <!-- ==================== Starting Steps Indicator =============== -->
          <div id="steps_container" class="step-container">
            <div class="step-item">
              <button class="step-button step-button-active">1</button>
            </div>

            <div class="step-connector step-connector-active"></div>
            <div class="step-item">
              <button class="step-button step-button-inactive">2</button>
            </div>

            <div class="step-connector step-connector-inactive"></div>

            <div class="step-item">
              <button class="step-button step-button-inactive">3</button>
            </div>
          </div>
          <!-- ==================== Ending Steps Indicator =============== -->

          <!-- ==================== Starting Payment Form =============== -->
          <form id="payment-form" style="margin-top: 16px">
            <div id="formContainer">
              <!-- Form Step 1 -->
              <div class="form-step form-step-1">
                <div class="step_title">
                  <h4 class=" ">Select Your Donation</h4>
                </div>
                <div>
                  <!-- TOGGLE BUTTON -->
                  <div class="toggle_container recurring_donation_field">
                    <div id="toggleButton" class="toggle_button">
                      <input
                        class="payment-type-input"
                        type="radio"
                        name="paymentType"
                        id="toggle1"
                        value="one-time"
                      />
                      <label for="toggle1">One Time</label>
                      <input
                        class="payment-type-input"
                        type="radio"
                        name="paymentType"
                        id="toggle2"
                        value="subscription"
                        checked
                      />
                      <label for="toggle2">
                        <span id="singleDonationLabel">Monthly </span>
                        <img
                          src="https://eventizer-dev-bucket.s3.ap-south-1.amazonaws.com/hearticon-335377.webp"
                          alt="Heart Icon"
                          loading="lazy"
                        />
                      </label>
                      <div class="toggle_background"></div>
                    </div>
                  </div>

                  <!-- Dropdown for recurring Donation options -->
                  <div
                    id="recurringDonationDropdown"
                    class="input_container mt-20"
                  >
                    <div class="custom-select-wrapper">
                      <div class="custom-select" id="paymentInterval">
                        <div class="select-trigger">Select payment option</div>
                        <div class="options-list"></div>
                      </div>
                    </div>
                  </div>

                  <div id="amountButtonContainer" class="amount_buttons">
                    <!-- Dynamic amount buttons will be rendered here -->
                  </div>

                  <div class="currency_container">
                    <!-- CURRENCY #Change the Icon and Currency Label -->
                    <p class="currency-symbol currency-icon">$</p>
                    <p class="currency-label currency-icon">USD</p>
                  </div>
                  <!-- CUSTOM AMOUNT INPUT FIELD -->
                  <div class="custom_amount_input">
                    <div class="input_container">
                      <label class="label" for="customAmount"
                        >Enter Custom Amount:
                      </label>
                      <input
                        id="amount"
                        type="text"
                        class="input amount_input"
                        placeholder="Enter amount"
                        name="amount"
                      />
                    </div>
                  </div>

                  <!-- #Change - render optional field by checek-->
                  <div class="mt-20 cover_platform_fee_container">
                    <div class="toggle-wrapper">
                      <span class="label"
                        >Add <span class="currency-icon">$</span
                        ><span id="platform-fee-indicator">0.00</span> to cover
                        the fee (optional)</span
                      >
                      <label class="toggle-container">
                        <input
                          id="platformFee"
                          name="includePlatformFee"
                          type="checkbox"
                          class="toggle-input"
                          sty
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>

                  <!-- NEXT BUTTON -->
                  <div>
                    <button
                      type="button"
                      class="next-button brand_button mt-20"
                    >
                      Donate
                      <span class="currency-icon">$</span
                      ><span class="payment-amount-indicator">00</span
                      ><span class="payment-type-indicator">/month</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Form Step 2 -->
              <div class="form-step form-step-2" style="display: none">
                <div class="step_title">
                  <h4 class=" ">Information</h4>
                </div>

                <div id="donorTypeContainerSelectBox">
                  <div>
                    <div class="input_container mt-20">
                      <div class="custom-select-wrapper">
                        <div class="custom-select" id="donorType">
                          <div class="select-trigger">Donation Type</div>
                          <div class="options-list"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="nameContainer">
                  <div class="name_container mt-20">
                    <div class="input_container name_input">
                      <label class="label" for="firstName">First Name:</label>
                      <input
                        id="firstName"
                        class="input"
                        type="text"
                        name="firstName"
                        placeholder="Enter your first name"
                      />
                    </div>

                    <div class="input_container name_input mt-m-20">
                      <label class="label" for="lastName">Last Name:</label>
                      <input
                        id="lastName"
                        class="input"
                        type="text"
                        name="lastName"
                        placeholder="Enter your last name"
                      />
                    </div>
                  </div>
                </div>

                <div id="organizationNameContainer">
                  <div class="name_container mt-20">
                    <div class="input_container name_input">
                      <label class="label" for="firstName"
                        >Organization Name:</label
                      >
                      <input
                        id="organizationName"
                        class="input"
                        type="text"
                        name="organizationName"
                        placeholder="Enter your organization name"
                      />
                    </div>

                    <div class="input_container name_input mt-m-20">
                      <label class="label" for="lastName">Tax ID/ EIN :</label>
                      <input
                        id="taxId"
                        class="input"
                        type="text"
                        name="taxId"
                        placeholder="Enter your last name"
                      />
                    </div>
                  </div>
                </div>

                <div>
                  <div class="input_container mt-20">
                    <label class="label" for="lastName">Email Address:</label>
                    <input
                      id="email"
                      class="input"
                      type="text"
                      name="email"
                      placeholder="Enter your email address"
                    />
                  </div>

                  <div class="mt-20 password_field_container">
                    <div class="eye-button">
                      <button type="button">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="lucide lucide-eye-off"
                        >
                          <path
                            d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"
                          />
                          <path d="M14.084 14.158a3 3 0 0 1-4.242-4.242" />
                          <path
                            d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"
                          />
                          <path d="m2 2 20 20" />
                        </svg>
                      </button>
                    </div>
                    <div class="input_container">
                      <label class="label" for="lastName"
                        >Subscription Password:</label
                      >
                      <input
                        id="password"
                        class="input"
                        type="password"
                        name="password"
                        placeholder="Enter your password to manage subscription"
                      />
                    </div>
                  </div>

                  <!-- #Change Optional Feild -->
                  <div class="input_container mt-20">
                    <label class="label" for="phoneNumber"
                      >Phone no: (optional)</label
                    >
                    <input
                      id="phoneNumber"
                      class="input"
                      type="text"
                      name="phoneNumber"
                      placeholder="Enter your phone number"
                    />
                  </div>

                  <!-- #Change Optional Feild -->
                  <div class="input_container mt-20 donnor_comments_field">
                    <label class="label" for="comments"
                      >Add Comments (optional)</label
                    >
                    <input
                      id="comments"
                      class="input"
                      type="text"
                      name="donorComments"
                      placeholder="Add Comments"
                    />
                  </div>

                  <div class="mt-20">
                    <div class="toggle-wrapper">
                      <span class="label">
                        Do you want this to be an anonymous donation?
                      </span>
                      <label class="toggle-container">
                        <input
                          id="anonymousDonation"
                          name="isAnonymousDonation"
                          type="checkbox"
                          class="toggle-input"
                          sty
                        />
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                </div>

                <button
                  type="button"
                  class="prev-button brand_button outline_button mt-20"
                >
                  Back
                </button>
                <button
                  id="nextButtonForOrganization"
                  type="button"
                  class="next-button brand_button mt-10"
                >
                  Next
                </button>
                <button
                  id="nextButtonForIndividual"
                  type="button"
                  class="next-button brand_button mt-10"
                >
                  Next
                </button>
              </div>

              <!-- Form Step 3 -->
              <div class="form-step form-step-3" style="display: none">
                <div class="step_title">
                  <h4 class=" ">Payment</h4>
                </div>
                <div class="card_container">
                  <div>
                    <label for="cardNumber" class="mb-8 label"
                      >Card Number</label
                    >
                    <div id="cardNumber"></div>

                    <small class="error card_number_error"
                      >Card number is required</small
                    >
                  </div>

                  <div class="mt-20 card-cvc-expiry-container">
                    <div class="card_item_container">
                      <label for="cardExpiry" class="mb-8 label">MM / YY</label>
                      <div id="cardExpiry"></div>
                      <small class="error card_expiry_error"
                        >Expiry date is required</small
                      >
                    </div>

                    <div class="card_item_container">
                      <label for="cardCVC" class="mb-8 label">Card CVC</label>
                      <div id="cardCVC"></div>
                      <small class="error card_cvc_error"
                        >CVC is required</small
                      >
                    </div>
                  </div>
                </div>

                <!-- Select Country -->
                <div class="input_container mt-20">
                  <label class="label" for="country">Country</label>
                  <div class="custom-select-wrapper">
                    <div class="custom-select" id="country">
                      <div class="select-trigger">Select Country</div>
                      <div class="options-list"></div>
                    </div>
                  </div>
                </div>

                <div class="name_container mt-20">
                  <div class="input_container name_input">
                    <label class="label" for="city">City:</label>
                    <input
                      id="city"
                      class="input"
                      type="text"
                      name="city"
                      placeholder="Enter your city"
                    />
                  </div>

                  <div class="input_container name_input mt-m-20">
                    <label class="label" for="state">State:</label>
                    <input
                      id="state"
                      class="input"
                      type="text"
                      name="state"
                      placeholder="Enter your state"
                    />
                  </div>
                </div>

                <div class="input_container mt-20">
                  <label class="label" for="zipCode">Billing ZIP Code</label>
                  <input
                    id="zipCode"
                    class="input zipcode_input"
                    type="text"
                    name="zipcode"
                    placeholder="Enter your billing zip code"
                  />
                </div>

                <button
                  type="button"
                  class="prev-button brand_button outline_button mt-20"
                >
                  Back
                </button>
                <button type="submit" class="next-button brand_button mt-10">
                  Donate
                  <!-- #Change the Icon  with dynamic currency icon -->
                  <span class="currency-icon">$</span
                  ><span class="payment-amount-indicator">00</span
                  ><span class="payment-type-indicator">/month</span>
                </button>
              </div>
            </div>
          </form>
          <!-- ==================== Ending Payment Form =============== -->
        </div>
        <div id="error-container"></div>
      </div>
    </div>

    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/just-validate@latest/dist/just-validate.production.min.js"></script>
    <script>
      (async function () {
        "use strict";

        // Loading Script
        const main_container = document.querySelector(".main_container");
        const loading_container = document.querySelector(".loading_container");
        const mainErrorContainer = document.getElementById("error-container");
        // Show the main content after the DOM is fully loaded
        document.addEventListener("DOMContentLoaded", function () {
          loading_container.style.display = "none";
          main_container.style.display = "block";
        });

        // Main Script
        const steps = document.querySelectorAll(".step-button");
        const connectors = document.querySelectorAll(".step-connector");
        const formSteps = document.querySelectorAll(".form-step");
        let currentStep = 0;

        // Backend Base URL
        const baseUrl = "https://sd-backend-l24l.onrender.com/api";
        //const baseUrl = 'http://localhost:3000/api';

        // Custom amounts buttons Container
        const amountButtonContainer = document.getElementById(
          "amountButtonContainer"
        );
        const paymentAmountIndicator = document.querySelectorAll(
          ".payment-amount-indicator"
        );

        // In form.html
        const urlParams = new URLSearchParams(window.location.search);
        const campaignId = urlParams.get("campaignId");
        const formDetails = await fetchCampaignFormData(campaignId);

        // // Inject form Colors
        injectDynamicColors(formDetails);

        // Handle Rendering optional feilds
        handleOptionalFields(formDetails);

        // Render the amount buttons on load
        renderAmountOptions(formDetails?.paymentAmounts || []);

        // THIS IS FORM DATA FOR STORE ALL FIELD VALUE
        let formData = {
          paymentType: `${
            formDetails?.recurringDonation ? "subscription" : "one-time" // Default Payment type
          }`,
          isAnonymousDonation: false, // Default isAnonymousDonation is false
          includePlatformFee: false, // Default includePlatformFee is false
          donorType: "organization", // Default Donor Type is Organization
        };

        // Select "Next" buttons and necessary input fields for validation
        const nextButtons = document.querySelectorAll(".next-button");
        const amountInput = document.getElementById("amount");
        const firstNameInput = document.getElementById("firstName");
        const lastNameInput = document.getElementById("lastName");

        const nextButtonForOrganization = document.getElementById(
          "nextButtonForOrganization"
        );
        const nextButtonForIndividual = document.getElementById(
          "nextButtonForIndividual"
        );

        const organizationNameInput =
          document.getElementById("organizationName");
        const taxIdInput = document.getElementById("taxId");
        const emailInput = document.getElementById("email");

        // Stripe Elements Error Containers
        const cardNumberError = document.querySelector(".card_number_error");
        const cardCVCError = document.querySelector(".card_cvc_error");
        const cardExpiryError = document.querySelector(".card_expiry_error");

        // Form Validation Status
        let isCardNumberValid = true;
        let isCVCValid = true;
        let isExpiryValid = true;
        let allFeildsValid = false;

        // Update step visuals and visibility
        function updateStep(step) {
          steps.forEach((btn, idx) => {
            btn.classList.toggle("step-button-active", idx <= step);
            btn.classList.toggle("step-button-inactive", idx > step);
          });

          connectors.forEach((connector, idx) => {
            connector.classList.toggle("step-connector-active", idx < step);
            connector.classList.toggle("step-connector-inactive", idx >= step);
          });

          formSteps.forEach((formStep, idx) => {
            formStep.style.display = idx === step ? "block" : "none";
          });
        }

        // Validate Step 1: Amount Input
        function validateStep1() {
          const isAmountFieldValid =
            amountInput.value.trim() !== "" &&
            !isNaN(amountInput.value) &&
            amountInput.value > 0;
          let isPaymentTypeValid;
          if (formDetails?.recurringDonation) {
            if (formDetails?.recurringDonationOptions?.length > 1) {
              isPaymentTypeValid =
                !!formData?.isPaymentIntervalSelect &&
                formData.isPaymentIntervalSelect.trim() !== "";
            } else {
              isPaymentTypeValid = true;
            }
          } else {
            isPaymentTypeValid = true;
          }

          const isValid = isAmountFieldValid && isPaymentTypeValid;

          disableNextButtonByStep(0, !isValid);
        }

        // Validate Step 2: First Name, Last Name, Email Inputs
        function validateStep2() {
          const isFirstNameValid = firstNameInput.value.trim() !== "";
          const isLastNameValid = lastNameInput.value.trim() !== "";
          const isOrganizationNameValid =
            organizationNameInput.value.trim() !== "";
          const isTaxIdValid = taxIdInput.value.trim() !== "";
          const isEmailValid =
            emailInput.value.trim() !== "" && emailInput.checkValidity();

          const isValidForOrganization =
            isOrganizationNameValid && isTaxIdValid && isEmailValid;
          const isValidForIndividual =
            isFirstNameValid && isLastNameValid && isEmailValid;

          // #Change
          disableNextButtonByStep(1, !isValidForOrganization);
          disableNextButtonByStep(2, !isValidForIndividual);
        }

        // Enable or disable "Next" button for a specific step
        function disableNextButtonByStep(step, disabled) {
          if (nextButtons[step]) nextButtons[step].disabled = disabled;
        }

        // Add input event listeners for real-time validation on each step
        amountInput?.addEventListener("input", validateStep1);
        firstNameInput?.addEventListener("input", validateStep2);
        lastNameInput?.addEventListener("input", validateStep2);
        organizationNameInput?.addEventListener("input", validateStep2);
        taxIdInput?.addEventListener("input", validateStep2);
        emailInput?.addEventListener("input", validateStep2);

        const paymentIntervalDropdown =
          document.getElementById("paymentInterval");
        // Add an event listener to handle dropdown interactions
        paymentIntervalDropdown?.addEventListener("click", (event) => {
          const optionsList =
            paymentIntervalDropdown.querySelector(".options-list");
          if (!optionsList) return;

          // Check if the user clicked on an option
          const clickedOption = event.target.closest(".options-list div");
          if (clickedOption) {
            formData.isPaymentIntervalSelect = clickedOption.textContent.trim();

            // Trigger validation for Step 1
            validateStep1();
          }
        });

        // "Next" button handler to progress through steps
        nextButtons.forEach((button, index) => {
          button.addEventListener("click", () => {
            if (validateStep(currentStep)) {
              currentStep = Math.min(formSteps.length - 1, currentStep + 1);
              updateStep(currentStep);

              // Trigger validation immediately on entering step 1 or 2
              if (currentStep === 0) validateStep1();
              if (currentStep === 1) validateStep2();
            }
          });
        });

        // "Back" button handler
        document.querySelectorAll(".prev-button").forEach((button) => {
          button.addEventListener("click", () => {
            currentStep = Math.max(0, currentStep - 1);
            updateStep(currentStep);

            // Trigger validation if returning to step 1 or 2
            if (currentStep === 0) validateStep1();
            if (currentStep === 1) validateStep2();
          });
        });

        // Validate all inputs in the current step
        function validateStep(step) {
          const inputs = formSteps[step].querySelectorAll("input");
          for (let input of inputs) {
            if (!input.checkValidity()) {
              input.reportValidity();
              return false;
            }
          }
          return true;
        }

        // Initial setup: update form to first step and validate
        updateStep(currentStep);
        validateStep1();
        validateStep2();

        // ===================== Stripe Elements Integration Code =====================//

        // Stripe Elements Integration Code
        const stripe = Stripe(
          "pk_test_51MZrfqFc2kgVKlwTcrHwFjFpeKnMiKSLqdQ2GS1zARx4IFEVZNVLqOqCo406zdeIOT3Vgwawtgz1eGg58cs9xT7t00hWZ5GQqe"
        );

        const elements = stripe.elements();

        const cardNumberElement = elements.create("cardNumber", {
          classes: {
            base: "stripe-element fieldBgColor fieldTextColor",
          },
          style: {
            base: {
              color: `${formDetails?.fieldTextColor || "#474747"}`,
              fontWeight: 600,
              fontSize: "14px",
              lineHeight: "20px",
              border: "1px solid #d5d5d5",
              borderRadius: "8px",
              padding: "12px 12px",
              fontFamily: "inherit",
              fontSmoothing: "antialiased",
              "::placeholder": {
                color: "#969696",
                fontSize: "13px",
                fontWeight: 500,
                fontFamily: "inherit",
              },
            },
          },
        });
        cardNumberElement.mount("#cardNumber");

        // Card Expiry Element
        const cardExpiryElement = elements.create("cardExpiry", {
          classes: {
            base: "stripe-element fieldBgColor fieldTextColor",
          },
          style: {
            base: {
              color: `${formDetails?.fieldTextColor || "#474747"}`,
              fontWeight: 600,
              fontSize: "14px",
              lineHeight: "20px",
              border: "1px solid #d5d5d5",
              borderRadius: "8px",
              padding: "12px 12px",
              fontFamily: "inherit",
              fontSmoothing: "antialiased",
              "::placeholder": {
                color: "#969696",
                fontSize: "13px",
                fontWeight: 500,
                fontFamily: "inherit",
              },
            },
          },
        });
        cardExpiryElement.mount("#cardExpiry");

        // Card CVC Element
        const cardCVCElement = elements.create("cardCvc", {
          classes: {
            base: "stripe-element fieldBgColor fieldTextColor",
          },
          style: {
            base: {
              color: `${formDetails?.fieldTextColor || "#474747"}`,
              fontWeight: 600,
              fontSize: "14px",
              lineHeight: "20px",
              border: "1px solid #d5d5d5",
              borderRadius: "8px",
              padding: "12px 12px",
              fontFamily: "inherit",
              fontSmoothing: "antialiased",
              "::placeholder": {
                color: "#969696",
                fontSize: "13px",
                fontWeight: 500,
                fontFamily: "inherit",
              },
            },
          },
        });
        cardCVCElement.mount("#cardCVC");

        // Apply the error handler to each Stripe Element
        handleStripeElementsChangeError(cardNumberElement, cardNumberError);
        handleStripeElementsChangeError(cardExpiryElement, cardExpiryError);
        handleStripeElementsChangeError(cardCVCElement, cardCVCError);

        // ================= Stripe Elements Integration Code End ================//

        // HANDLE PAYMENT TYPE #CHANGE
        const paymentTypeInput = document.querySelectorAll(
          ".payment-type-input"
        );

        const paymentTypeIndicator = document.querySelectorAll(
          ".payment-type-indicator"
        );
        const singleDonationOptionLabel = document.getElementById(
          "singleDonationLabel"
        );


        if (formDetails?.recurringDonation) {
            if (formDetails?.recurringDonationOptions?.length === 1 ) {
                formData = {
                    ...formData,
                    paymentType: "subscription",
                    paymentInterval: formDetails?.recurringDonationOptions[0]?.value
                }
            }
        }

        function handleSingleOptionPaymentType(paymentInterval) {
          paymentTypeIndicator?.forEach((item) => {
            if (formDetails?.recurringDonation) {
              item.textContent = `/${paymentInterval?.value}`;
            } else {
              item.textContent = "";
            }
          });
          singleDonationOptionLabel.textContent = `${paymentInterval?.value}`;
          singleDonationOptionLabel.style.textTransform = "capitalize";

          paymentTypeInput?.forEach((input) => {
            input.addEventListener("change", () => {
              formData = {
                ...formData,
                paymentType: input.value,
                paymentInterval: paymentInterval?.value,
              };
              // Hide password field for one-time payment
              formData?.paymentType === "one-time"
                ? (document.querySelector(
                    ".password_field_container"
                  ).style.display = "none")
                : (document.querySelector(
                    ".password_field_container"
                  ).style.display = "block");

              handlePasswordFieldValidation(formData, formDetails);
              paymentTypeIndicator?.forEach((item) => {
                if (formDetails?.recurringDonation) {
                  if (input?.value === "subscription") {
                    item.textContent = `/${paymentInterval?.value}`;
                  } else if (input?.value === "one-time") {
                    item.textContent = "";
                  }
                } else {
                  item.textContent = "";
                }
              });
            });
          });
        }
        handleSingleOptionPaymentType(
          Array.isArray(formDetails?.recurringDonationOptions)
            ? formDetails.recurringDonationOptions[0] || {}
            : {}
        );

        // Function to render the amount options dynamically
        function renderAmountOptions(paymentAmountArray) {
          paymentAmountArray?.forEach(({ id, amount, currency }) => {
            const button = document.createElement("button");
            button.type = "button";
            button.classList.add("amount_button");
            button.textContent = `${
              formDetails?.currency?.symbol || "$"
            } ${amount}`;
            button.onclick = () => handleAmountSelect(id, amount, button); // Pass id for selection
            amountButtonContainer.appendChild(button);
          });
        }

        // Handle amount button selection
        let selectedAmountId = null;
        function handleAmountSelect(id, amount, button) {
          if (selectedAmountId === id) {
            selectedAmountId = null;
            amountInput.value = ""; // Clear input field
            delete formData.amount;
            validator.revalidateField("#amount");
          } else {
            selectedAmountId = id;
            amountInput.value = amount;
            formData = { ...formData, amount: amount };
            validator.revalidateField("#amount");
            handleAmountUpdate(amount);
          }

          // Trigger validation for amount input
          validateStep1();

          document.querySelectorAll(".amount_button").forEach((btn) => {
            btn.classList.remove("selected");
          });
          if (selectedAmountId) {
            button.classList.add("selected");
          }
        }

        // Handle custom amount input change
        amountInput.addEventListener("input", (e) => {
          const amountNumber =
            typeof e.target.value === "number"
              ? e.target.value
              : parseFloat(e.target.value);

          if (!isNaN(amountNumber) && amountNumber > 0) {
            handleAmountUpdate(amountNumber);
            selectedAmountId = null; // Reset selected amount
            document.querySelectorAll(".amount_button").forEach((btn) => {
              btn.classList.remove("selected"); // Clear all button selections
            });
          } else {
            handleAmountUpdate(0);
          }
        });

        function handleAmountUpdate(amount) {
          const platFormCharge = calculatePlatformCost(amount);
          if (amount > 0 && !isNaN(amount)) {
            if (formData?.includePlatformFee) {
              formData = { ...formData, amount: amount + platFormCharge };
            } else {
              formData = { ...formData, amount: amount };
            }
          } else {
            formData = { ...formData, amount: 0 };
          }

          // Updating Payment Amount for Button
          paymentAmountIndicator?.forEach((item) => {
            item.textContent = formData?.amount || 0;
          });

          // Calculate And Apply Platform Fees
          if (formDetails?.coverPlatformFee) {
            const platFormFeeIndicator = document.getElementById(
              "platform-fee-indicator"
            );
            if (platFormCharge > 0 && !isNaN(amount) && amount > 0) {
              platFormFeeIndicator.textContent = platFormCharge;
            } else {
              platFormFeeIndicator.textContent = 0;
            }
          }
        }

        // Handle Input Items Changes
        const inputFields = document.querySelectorAll(".input");
        inputFields?.forEach((input) => {
          input.addEventListener("input", (e) => {
            if (e.target.name === "amount") {
              formData = { ...formData, amount: parseFloat(e.target.value) };
            } else {
              formData = { ...formData, [e.target.name]: e.target.value };
            }
          });
        });

        // HANDLE PASSWORD EYE BUTTON CLICK
        const eyeButton = document.querySelector(".eye-button button");
        const passwordField = document.querySelector("#password");
        if (eyeButton) {
          eyeButton.addEventListener("click", (e) => {
            if (passwordField.type === "text") {
              passwordField.type = "password";

              // Inseting Icon
              eyeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye-off"><path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"/><path d="M14.084 14.158a3 3 0 0 1-4.242-4.242"/><path d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"/><path d="m2 2 20 20"/></svg>`;
            } else {
              passwordField.type = "text";
              // Inseting Icon
              eyeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-eye"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>`;
            }
          });
        }

        // Handle Platform Fees input
        const platformFeeswitch = document.getElementById("platformFee");
        platformFeeswitch.addEventListener("input", (e) => {
          if (e.target.checked) {
            if (amountInput.value > 0 && !isNaN(amountInput.value)) {
              formData = { ...formData, includePlatformFee: true };
              handleAmountUpdate(parseFloat(amountInput.value));
            }
          } else {
            formData = { ...formData, includePlatformFee: false };
            handleAmountUpdate(parseFloat(amountInput.value));
          }
        });

        // Handle Anonymous Donation input
        const anonymousDonationSwitch =
          document.getElementById("anonymousDonation");
        anonymousDonationSwitch.addEventListener("input", (e) => {
          if (e.target.checked) {
            formData = { ...formData, isAnonymousDonation: true };
          } else {
            formData = { ...formData, isAnonymousDonation: false };
          }
        });

        //Initiate Form Validation Validator
        const validator = new JustValidate("#payment-form", {
          validateBeforeSubmitting: true,
        });
        // Form Validation Code
        validator
          .addField("#zipCode", [
            {
              rule: "required",
              errorMessage: "Zip code is required",
            },
          ])
          .addField("#amount", [
            {
              rule: "required",
              errorMessage: "Amount is required",
            },
            {
              rule: "customRegexp",
              value: /^(?!0(\.0+)?$)\d+(\.\d+)?$/,
              errorMessage: "Amount must be a valid number greater than 0",
            },
          ])
          .addField("#email", [
            {
              rule: "required",
              errorMessage: "Email is required",
            },
            {
              rule: "email",
              errorMessage: "Email is not valid",
            },
          ])
          .addField("#phoneNumber", [
            {
              rule: "customRegexp",
              value: /^[0-9]+$/,
              errorMessage: "Phone number must be a number",
            },
          ])
          .addField("#city", [
            {
              rule: "required",
              errorMessage: "City is required",
            },
          ])
          .addField("#state", [
            {
              rule: "required",
              errorMessage: "State is required",
            },
          ])
          .onSuccess((event) => {
            allFeildsValid = true;
          });

        function validateStripeElements(params) {
          let isError = false;
          if (cardNumberElement._empty) {
            cardNumberError.textContent = "Card number is required";
            cardNumberError.style.display = "block";
            isError = true;
          }
          if (cardCVCElement._empty) {
            cardCVCError.textContent = "CVC code is required";
            cardCVCError.style.display = "block";
            isError = true;
          }
          if (cardExpiryElement._empty) {
            cardExpiryError.textContent = "Expiry date is required";
            cardExpiryError.style.display = "block";
            isError = true;
          }

          if (!isError) {
            return true;
          }
          return false;
        }

        // Handle Stripe Elements Change
        function handleStripeElementsChangeError(element, errorContainer) {
          element.on("change", function (event) {
            if (event.error) {
              errorContainer.textContent = event.error.message;
              errorContainer.style.display = "block";
              errorContainer.style.color = "#b81111";
              checkCardValid(event, false);
            } else if (event.complete) {
              errorContainer.textContent = "Looks good!";
              errorContainer.style.display = "block";
              errorContainer.style.color = "green";
              checkCardValid(event, true);
            } else {
              errorContainer.style.display = "none";
              checkCardValid(event, true);
            }
          });
        }

        // Checked Validation
        function checkCardValid(event, bool) {
          if (event.elementType === "cardNumber") {
            isCardNumberValid = bool;
          } else if (event.elementType === "cardCvc") {
            isCVCValid = bool;
          } else if (event.elementType === "cardExpiry") {
            isExpiryValid = bool;
          }
        }

        // Handle Form Submit
        const form = document.getElementById("payment-form");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const isStripeElementsValueExist = validateStripeElements();

          // If Not Valid, Return
          if (
            !isStripeElementsValueExist ||
            !isCardNumberValid ||
            !isCVCValid ||
            !isExpiryValid ||
            !allFeildsValid
          ) {
            return;
          }

          handleStripePayment();
        });

        // Handling Payment create Api Call
        async function handleStripePayment() {
          try {
            // Show loading state
            const submitButton = document.querySelector(
              'button[type="submit"]'
            );
            if (submitButton) {
              submitButton.disabled = true;
              submitButton.textContent = "Processing...";
            }

            const paidCurrencyType =
              formDetails?.currency?.name.toLowerCase() || "usd";

            console.log(formData);

            // Payload for one time donation
            const payloadForOneTimeDonation = {
              amount: formData?.amount || 0,
              currency: paidCurrencyType,
              firstName: formData?.firstName,
              lastName: formData?.lastName,

              email: formData?.email,
              phone: formData?.phoneNumber,
              zip: formData?.zipCode,
              campaignId: campaignId,
              donationType: formData?.paymentType,
              includePlatformFee: formData?.includePlatformFee,
              comment: formData?.donorComments,
              subscriptionInterval:
                formData?.paymentType === "subscription"
                  ? formData?.paymentInterval || "monthly"
                  : "one-time",
              platformFeeAmount: formData?.platformFeeAmount,

              // New
              organizationName: formData?.organizationName,
              taxId: formData?.taxId,

              // New Fields
              country: formData?.country,
              state: formData?.state,
              city: formData?.city,
              donorType: formData?.donorType,
              isAnonymousDonation: formData?.isAnonymousDonation,
            };

            // Payload for subscription donation
            const payloadForSubscriptionDonation = {
              amount: formData?.amount || 0,
              currency: paidCurrencyType,
              firstName: formData?.firstName,
              lastName: formData?.lastName,
              email: formData?.email,
              phone: formData?.phoneNumber,
              zip: formData?.zipCode,
              campaignId: campaignId,
              donationType: formData?.paymentType,
              includePlatformFee: formData?.includePlatformFee,
              comment: formData?.donorComments,
              subscriptionInterval:
                formData?.paymentType === "subscription"
                  ? formData?.paymentInterval
                  : "one-time",
              password: formData?.password,
              platformFeeAmount: formData?.platformFeeAmount,

              // New
              organizationName: formData?.organizationName,
              taxId: formData?.taxId,

              // New Fields
              country: formData?.country,
              state: formData?.state,
              city: formData?.city,
              donorType: formData?.donorType,
              isAnonymousDonation: formData?.isAnonymousDonation,
            };

            // Create payment intent
            const response = await fetch(
              formData?.paymentType === "subscription"
                ? `${baseUrl}/donations/create-subscription-intent`
                : `${baseUrl}/donations/create-onetime-intent`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(
                  formData?.paymentType === "subscription"
                    ? payloadForSubscriptionDonation
                    : payloadForOneTimeDonation
                ),
                credentials: "same-origin",
              }
            );

            if (!response.ok) {
              throw new Error(
                `Payment intent creation failed: ${response.statusText}`
              );
            }
            const data = await response.json();
            const { clientSecret, subscriptionId } = data;
            if (!clientSecret) {
              throw new Error("No client secret received from server");
            }

            // Confirm the card payment
            const result = await stripe.confirmCardPayment(clientSecret, {
              payment_method: {
                card: cardNumberElement,
                billing_details: {
                  name: `${formData.firstName} ${formData.lastName}`,
                  address: {
                    postal_code: formData?.zipCode,
                  },
                  email: formData?.email,
                  phone: formData?.phoneNumber,
                },
              },
            });

            if (result.error) {
              throw new Error(result.error.message);
            }

            if (result.paymentIntent?.status === "succeeded") {
              console.log("🚀 ~ handleStripePayment ~ result:", result);
              // Verify payment and create donation record
              const verificationResponse = await fetch(
                `${baseUrl}/donations/verify-intent`,
                {
                  method: "PATCH",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    paymentIntentId:
                      formData.paymentType === "one-time"
                        ? result.paymentIntent.id
                        : undefined,
                    subscriptionId:
                      formData.paymentType === "subscription"
                        ? subscriptionId
                        : undefined,
                  }),
                  credentials: "same-origin",
                }
              );

              if (!verificationResponse.ok) {
                throw new Error("Payment verification failed");
              }

              const verificationData = await verificationResponse.json();

              if (verificationData.success) {
                showSuccessMessage(
                  formDetails?.thankYouMessage || "Payment successful!"
                );

                if (formDetails?.redirectUrl) {
                  setTimeout(() => {
                    window.location.href = formDetails.redirectUrl;
                  }, 3000);
                }

                // You can use verificationData.data here to show additional details or redirect
                return verificationData.data;
              } else {
                throw new Error(
                  verificationData.message || "Payment verification failed"
                );
              }
            }
          } catch (error) {
            console.error("Payment failed:", error.message);
            showErrorMessage(`Payment failed! ${error.message}`);
            throw error;
          } finally {
            const submitButton = document.querySelector(
              'button[type="submit"]'
            );
            if (submitButton) {
              submitButton.disabled = false;
              submitButton.textContent = "Submit Payment";
            }
          }
        }

        // Helper functions for UI feedback
        function showSuccessMessage(message) {
          const messageElement =
            document.querySelector(".payment-message") ||
            createMessageElement();
          messageElement.textContent = message;
          messageElement.className = "payment-message payment-success";
          const formContainer = document.getElementById("formContainer");
          formContainer.style.display = "none";
          const stepsContainer = document.getElementById("steps_container");
          stepsContainer.style.display = "none";
        }

        function showErrorMessage(message) {
          const messageElement =
            document.querySelector(".payment-message") ||
            createMessageElement();
          messageElement.textContent = message;
          messageElement.className = "payment-message payment-error";
          const formContainer = document.getElementById("formContainer");
          formContainer.style.display = "none";
          const stepsContainer = document.getElementById("steps_container");
          stepsContainer.style.display = "none";
        }

        function createMessageElement() {
          const messageElement = document.createElement("div");
          messageElement.className = "payment-message";
          const form = document.getElementById("payment-form");
          form.insertBefore(messageElement, form.firstChild);
          return messageElement;
        }

        // Helper function to inject dynamic colors
        function injectDynamicColors(colorsObject) {
          const style = document.createElement("style");
          style.innerHTML = `

          /*===============Button Css =============  */

          .brand_button{
            background-color: ${colorsObject?.primaryColor} !important;
            color: ${colorsObject?.buttonTextColor} !important;
          }

          .brand_button:disabled {
            background-color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.5
            )} !important;
          }

          .brand_button:disabled:hover {
            background-color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.5
            )} !important;
          }

          .outline_button:hover {
            color: ${colorsObject?.buttonTextColor} !important;
            background-color: ${colorsObject?.primaryColor} !important;
          }

          .brand_button.outline_button {
            background-color: transparent !important;
            color: ${colorsObject?.primaryColor} !important;
            border: 2px solid ${colorsObject?.primaryColor} !important;
          }

          .brand_button.outline_button:hover {
            background-color: ${colorsObject?.primaryColor} !important;
            color: ${colorsObject?.buttonTextColor} !important;
          }



          /*===============Input Css =============  */

          .input{
            background-color: ${colorsObject?.fieldBgColor} !important;
            color: ${colorsObject?.fieldTextColor} !important;
            border: 1px solid ${colorsObject?.borderColor} !important;
          }
          .input:focus{
            outline-color:${colorsObject?.primaryColor} !important;
          }
          .label{
            color: ${colorsObject?.fieldTextColor} !important;
          }



          /*===============Stripe Element Css =============  */

          .stripe-element{
            border: 1px solid ${colorsObject?.borderColor} !important;
          }



          /*===============Step Button Css =============  */

          .step-button-active {
            background-color: ${colorsObject?.primaryColor} !important;
            color: ${colorsObject?.buttonTextColor} !important;
            border-color: ${colorsObject?.primaryColor} !important;
          }
          .step-button-inactive{
            color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.4
            )} !important;
            border-color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.2
            )} !important;
          }
          .step-connector-active {
            background-color: ${colorsObject?.primaryColor} !important;
          }
          .step-connector-inactive {
            background-color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.2
            )} !important;
          }


          /*===============Form Background Css =============  */
          .form_container {
            background-color: ${colorsObject?.formBgColor} !important;
          }


          /*===============Form Background Css =============  */
          .toggle_background {
            background-color: ${colorsObject?.primaryColor} !important;
          }

          .toggle_button input#toggle1:checked + label[for="toggle1"],
          .toggle_button input#toggle2:checked + label[for="toggle2"] {
            color: ${colorsObject?.buttonTextColor} !important;
          }

          /*===============Amount Button Css =============  */
          .amount_button{
            border: 1px solid ${colorsObject?.borderColor} !important;
          }
          .amount_button:hover {
            border-color: ${colorsObject?.primaryColor} !important;
            color: ${colorsObject?.primaryColor} !important;
          }
          .amount_button.selected {
            background-color: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.2
            )} !important;
            border-color: ${colorsObject?.primaryColor} !important;
            color: ${colorsObject?.primaryColor} !important;
          }


          .toggle-input:checked + .toggle-slider {
            background-color: ${colorsObject?.primaryColor} !important;
          }

          /*===============Dropdown Css =============  */

          .options-list::-webkit-scrollbar-thumb {
            background:${colorsObject?.primaryColor} !important;
          }
          .option-item:hover {
            background: ${generateLiteColor(
              colorsObject?.primaryColor,
              0.1
            )} !important;
            color: ${colorsObject?.primaryColor} !important;
          }
          .select-trigger::after {
            border-right: 2px solid ${colorsObject?.borderColor} !important;
            border-bottom: 2px solid ${colorsObject?.borderColor} !important;
          }
          .select-trigger:hover:not(.disabled) {
            border-color: ${colorsObject?.primaryColor} !important;
          }
          .select-trigger {
            background: ${colorsObject?.fieldBgColor} !important;
            border: 1px solid ${colorsObject?.borderColor} !important;
            color: ${colorsObject?.fieldTextColor} !important;
          }
        `;
          document.head.appendChild(style);
        }

        function generateLiteColor(hexColor, opacity) {
          const isHex = /^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hexColor);
          if (!isHex) {
            return hexColor; // Return original color if not valid hex
          }

          // Ensure hex color starts with "#"
          if (hexColor.charAt(0) === "#") hexColor = hexColor.substring(1);

          // Parse the hex color into RGB components
          const r = parseInt(hexColor.substring(0, 2), 16);
          const g = parseInt(hexColor.substring(2, 4), 16);
          const b = parseInt(hexColor.substring(4, 6), 16);

          // Create RGBA string with the provided opacity
          return `rgba(${r}, ${g}, ${b}, ${opacity})`;
        }

        // Handle optional feild render on Dom
        function handleOptionalFields(formDetails) {
          // Hide recurring donation field
          formDetails?.recurringDonation === false &&
            (document.querySelector(".recurring_donation_field").style.display =
              "none");

          // Hide Password Feild
          formDetails?.recurringDonation === false &&
            (document.querySelector(".password_field_container").style.display =
              "none");

          // Hide Cover Platform fee
          formDetails?.coverPlatformFee === false &&
            (document.querySelector(
              ".cover_platform_fee_container"
            ).style.display = "none");

          // Hide donor comments
          formDetails?.donorComments === false &&
            (document.querySelector(".donnor_comments_field").style.display =
              "none");
        }

        // Fetch campaign settings
        async function fetchCampaignFormData(campaignId) {
          try {
            loading_container.style.display = "block";
            main_container.style.display = "none";
            const response = await fetch(
              `${baseUrl}/custom-forms/campaign/${campaignId}`,
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );
            if (!response.ok) {
              throw new Error("Failed to fetch campaign settings");
            }
            const data = await response.json();
            return data?.data || {};
          } catch (error) {
            console.log(error);
            loading_container.style.display = "hidden";
            loading_container.style.display = "none";
            main_container.style.display = "none";

            mainErrorContainer.innerHTML = `<p class="text-red-500">Failed to fetch campaign settings. Please try again later</p>`;
            mainErrorContainer.style.paddingBottom = "2rem";
            return {};
          }
        }

        // Calculates 1% of the given amount
        function calculatePlatformCost(amount) {
          const platformFeeAmount = parseFloat(amount) * 0.01;
          formData = { ...formData, platformFeeAmount };
          return platformFeeAmount;
        }

        // // Create Dynamic Currency Icon and label
        // const dummyCurrency = {
        //   name: "USD",
        //   symbol: "$",
        // };
        function createCurrencyIconAndLabel(currencyObject) {
          const currencyIcons = document.querySelectorAll(".currency-icon");
          const currencyLabels = document.querySelectorAll(".currency-label");
          currencyIcons.forEach((icon) => {
            icon.textContent = currencyObject?.symbol || "$";
          });
          currencyLabels.forEach((label) => {
            label.textContent = currencyObject?.name || "USD";
          });
        }
        createCurrencyIconAndLabel(formDetails?.currency);

        // Handle password validation
        const handlePasswordFieldValidation = (formData, formDetails) => {
          if (
            formData?.paymentType === "subscription" &&
            formDetails?.recurringDonation
          ) {
            validator.addField("#password", [
              {
                rule: "required",
                errorMessage: "Password is required",
              },
              {
                rule: "password",
                errorMessage: "Password must be strong",
              },
            ]);
          } else {
            validator.removeField("#password");
          }
        };
        // Conditional validation for password field
        handlePasswordFieldValidation(formData, formDetails);

        // HANDLE DROPDOWN FIELD VALIDATION

        const handleDropdownFieldValidation = (
          formData,
          fieldId,
          fieldName
        ) => {
          if (!formData?.[fieldId]) {
            validator.addField(`#${fieldId}`, [
              {
                rule: "required",
                errorMessage: `${fieldName} is required`,
              },
            ]);
          } else {
            validator.removeField(`#${fieldId}`);
          }
        };
        handleDropdownFieldValidation(formData, "country", "Country");
        handleDropdownFieldValidation(formData, "donorType", "Donor Type");

        // ==================**** Handle Country select dropdown ******==================//

        class CustomSelect {
          constructor(element, options = {}) {
            this.element = element;
            this.options = options;
            this.trigger = element.querySelector(".select-trigger");
            this.optionsList = element.querySelector(".options-list");
            this.isDisabled = this.trigger.classList.contains("disabled");
            this.selectedValue = "";

            if (!this.isDisabled) {
              this.setupListeners();
            }
          }

          setupListeners() {
            this.trigger.addEventListener("click", () => this.toggle());

            document.addEventListener("click", (e) => {
              if (!this.element.contains(e.target)) {
                this.close();
              }
            });
          }

          toggle() {
            if (this.isDisabled) return;
            this.element.classList.toggle("open");
          }

          close() {
            this.element.classList.remove("open");
          }

          update(options, defaultText = "") {
            this.optionsList.innerHTML = "";
            this.trigger.textContent = defaultText || "Select option";
            this.selectedValue = "";

            options.forEach((option) => {
              const optionElement = document.createElement("div");
              optionElement.classList.add("option-item");
              optionElement.textContent = option.label;
              optionElement.addEventListener("click", () => {
                this.selectedValue = option.value;
                this.trigger.textContent = option.label;
                formData = { ...formData, [this.element.id]: option.value };
                console.log(formData);
                handleDropdownFieldValidation(
                  formData,
                  this.element.id,
                  this.element.id
                );
                this.close();
                if (this.options.onChange) {
                  this.options.onChange(option.value);
                }
              });
              this.optionsList.appendChild(optionElement);
            });
          }
        }

        // Initialize custom select for country only
        const countrySelect = new CustomSelect(
          document.getElementById("country")
        );

        // Fetch and populate countries
        async function fetchCountries() {
          try {
            // Fetch countries
            const response = await fetch("https://restcountries.com/v3.1/all");
            const countries = await response.json();
            const countryOptions = countries
              .sort((a, b) => a.name.common.localeCompare(b.name.common))
              .map((country) => ({
                label: country?.name?.common,
                value: country?.name?.common,
              }));

            countrySelect.update(countryOptions, "Select Country");
          } catch (error) {
            console.error("Error fetching countries:", error);
          }
        }

        const donorType = new CustomSelect(
          document.getElementById("donorType")
        );

        donorType.update(
          [
            { label: "Organization", value: "organization" },
            { label: "Company", value: "company" },
            { label: "Individual", value: "individual" },
          ],
          "Organization"
        );

        // Initialize the country dropdown
        fetchCountries();

        function handleRecurringDonationLogic(
          isRecurringDonation,
          recurringDonationOptions
        ) {
          const toggleContainer = document.querySelector(
            ".recurring_donation_field"
          );
          const recurringDonationDropdown = document.getElementById(
            "recurringDonationDropdown"
          );

          if (isRecurringDonation) {
            if (recurringDonationOptions?.length > 1) {
              // Show recurring donation options
              toggleContainer.style.display = "none";
              recurringDonationDropdown.style.display = "block";

              // Populate recurring donation options
              const donationTypeOptions = new CustomSelect(
                document.getElementById("paymentInterval")
              );

              donationTypeOptions.update(
                recurringDonationOptions,
                "Select payment type"
              );
            } else {
              toggleContainer.style.display = "block";
              recurringDonationDropdown.style.display = "none";
            }
          } else {
            toggleContainer.style.display = "none";
            recurringDonationDropdown.style.display = "none";
          }
        }

        // Call the function of recurring donation
        handleRecurringDonationLogic(
          formDetails?.recurringDonation,
          formDetails?.recurringDonationOptions || []
        );

        function HandleFormForPopup(isPopupActive, popupkey) {
          const popupOverlay = document.querySelector(
            "#donation-form-popup-overlay"
          );
          const closeButtonContainer = document.getElementById(
            "close-button-container"
          );
          const closeButton = document.querySelector(".close-button");
          const openPopupButton = document.querySelector("#open-popup-button");
          const donationFormPopup = document.getElementById(
            "donation-form-popup"
          );
          // Select all links with the specific href
          const openPopupLinksButtons = document.querySelectorAll(
            `a[href="${popupkey}"]`
          );

          // Add event listener to links
          openPopupLinksButtons.forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault(); // Prevent page reload
              popupOverlay.style.display = "flex";
              updateUrlParam("popup-open", popupkey); // Add the parameter
            });
          });

          if (isPopupActive) {
            // Show popup when button is clicked
            if (openPopupButton) {
              openPopupButton.addEventListener("click", (e) => {
                e.preventDefault(); // Prevent page reload
                popupOverlay.style.display = "flex";
                updateUrlParam("popup-open", popupkey); // Add the parameter
              });
            }

            // Close popup and remove the parameter
            if (closeButton) {
              closeButton.addEventListener("click", () => {
                popupOverlay.style.display = "none";
                updateUrlParam("popup-open", null); // Remove the parameter
              });
            }

            // Close popup when clicking outside the popup content
            if (popupOverlay) {
              popupOverlay.addEventListener("click", (e) => {
                if (e.target === popupOverlay) {
                  popupOverlay.style.display = "none";
                  updateUrlParam("popup-open", null); // Remove the parameter
                }
              });
            }

            // Check the popup-open parameter and display the popup on page load
            checkPopupParam();

            function checkPopupParam() {
              const urlParams = new URLSearchParams(window.location.search);
              const popupOpenParam = urlParams.get("popup-open");
              if (popupOpenParam === popupkey) {
                popupOverlay.style.display = "flex";
              }
            }
          } else {
            // Clean up IDs and hide elements
            popupOverlay?.removeAttribute("id");
            openPopupButton?.removeAttribute("id");
            donationFormPopup?.removeAttribute("id");
            closeButton?.removeAttribute("id");
            if (closeButtonContainer) {
              closeButtonContainer.style.display = "none";
            }
          }

          // Helper function to update the URL without reloading
          function updateUrlParam(param, value) {
            const url = new URL(window.location);
            if (value) {
              url.searchParams.set(param, value);
            } else {
              url.searchParams.delete(param);
            }
            window.history.replaceState({}, "", url);
          }
        }

        HandleFormForPopup(formDetails?.isPopActive, formDetails?.popupKey);

        // Handle Donor Type
        const donorTypeDropdown = document.getElementById("donorType");
        if (donorTypeDropdown) {
          donorTypeDropdown.addEventListener("click", (event) => {
            const optionsList =
              donorTypeDropdown.querySelector(".options-list");
            if (!optionsList) return;
            const clickedOption = event.target.closest(".options-list div");
            if (clickedOption) {
              if (
                formData?.donorType === "company" ||
                formData?.donorType === "organization"
              ) {
                handleDonorTypeChange(true);
                console.log("organization clicked");
              } else {
                handleDonorTypeChange(false);
                console.log("individual clicked");
              }
            }
          });
        }

        const handleDonorTypeChange = (isOrganizationSelected) => {
          const nameContainer = document.getElementById("nameContainer");
          const organizationContainer = document.getElementById(
            "organizationNameContainer"
          );

          if (isOrganizationSelected) {
            nameContainer.style.display = "none";
            organizationContainer.style.display = "block";
            nextButtonForOrganization.style.display = "block";
            nextButtonForIndividual.style.display = "none";
            validateWithChange(true);
          } else {
            nameContainer.style.display = "block";
            organizationContainer.style.display = "none";
            nextButtonForOrganization.style.display = "none";
            nextButtonForIndividual.style.display = "block";
            validateWithChange(false);
          }
        };

        const donationByCompanyContainer = document.getElementById(
          "donorTypeContainerSelectBox"
        );
        if (formDetails?.donationByCompany) {
          donationByCompanyContainer.style.display = "block";
          validateWithChange(formDetails?.donationByCompany);
          handleDonorTypeChange(formDetails?.donationByCompany);
        } else {
          donationByCompanyContainer.style.display = "none";
          validateWithChange(formDetails?.donationByCompany);
          handleDonorTypeChange(formDetails?.donationByCompany);
        }

        function validateWithChange(isOrganization) {
          if (!isOrganization) {
            validator
              .addField("#firstName", [
                {
                  rule: "required",
                  errorMessage: "First name is required",
                },
                {
                  rule: "minLength",
                  value: 2,
                  errorMessage: "First name must be at least 2 characters",
                },
                {
                  rule: "maxLength",
                  value: 50,
                  errorMessage: "First name must be at most 50 characters",
                },
              ])
              .addField("#lastName", [
                {
                  rule: "required",
                  errorMessage: "Last name is required",
                },
                {
                  rule: "maxLength",
                  value: 50,
                  errorMessage: "Last name must be at most 50 characters",
                },
              ]);

            // Remove existing validation rules for organizationName and taxId
            validator.removeField("#organizationName");
            validator.removeField("#taxId");
          } else {
            validator
              .addField("#organizationName", [
                {
                  rule: "required",
                  errorMessage: "Organization name is required",
                },
              ])
              .addField("#taxId", [
                {
                  rule: "required",
                  errorMessage: "Tax ID / EIN is required",
                },
              ]);

            // Remove existing validation rules for firstName and lastName
            validator.removeField("#firstName");
            validator.removeField("#lastName");
          }
        }
      })();
    </script>
  </body>
</html>
